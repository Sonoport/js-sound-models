<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/lib/core/Envelope.js - javascript-sound-models</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="javascript-sound-models"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AudioContextMonkeyPatch.html">AudioContextMonkeyPatch</a></li>
            
                <li><a href="../classes/BaseSound.html">BaseSound</a></li>
            
                <li><a href="../classes/Config.html">Config</a></li>
            
                <li><a href="../classes/Converter.html">Converter</a></li>
            
                <li><a href="../classes/DetectLoopMarkers.html">DetectLoopMarkers</a></li>
            
                <li><a href="../classes/Envelope.html">Envelope</a></li>
            
                <li><a href="../classes/FileLoader.html">FileLoader</a></li>
            
                <li><a href="../classes/Looper.html">Looper</a></li>
            
                <li><a href="../classes/MuliFileLoader.html">MuliFileLoader</a></li>
            
                <li><a href="../classes/SoundQueue.html">SoundQueue</a></li>
            
                <li><a href="../classes/SPAudioBufferSourceNode.html">SPAudioBufferSourceNode</a></li>
            
                <li><a href="../classes/SPAudioParam.html">SPAudioParam</a></li>
            
                <li><a href="../classes/SPEvent.html">SPEvent</a></li>
            
                <li><a href="../classes/SPPlaybackRateParam.html">SPPlaybackRateParam</a></li>
            
                <li><a href="../classes/Trigger.html">Trigger</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Core.html">Core</a></li>
            
                <li><a href="../modules/Models.html">Models</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/lib/core/Envelope.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 *  @module Core
 */
define( [ &#x27;core/BaseSound&#x27; ], function ( BaseSound ) {
    &#x27;use strict&#x27;;

    /**
     * Envelope class that extends BaseSound which implements an ASDR Envelope.
     *
     * @class Envelope
     * @constructor
     * @extends BaseSound
     * @param {AudioContext} context AudioContext in which this Sound is defined.
     */
    function Envelope( context ) {
        // This first guard ensures that the callee has invoked our Class&#x27; constructor function
        // with the &#x60;new&#x60; keyword - failure to do this will result in the &#x60;this&#x60; keyword referring
        // to the callee&#x27;s scope (typically the window global) which will result in the following fields
        // (name and _age) leaking into the global namespace and not being set on this object.
        // source: https://gist.github.com/jonnyreeves/2474026
        if ( !( this instanceof Envelope ) ) {
            throw new TypeError( &quot;Envelope constructor cannot be called as a function.&quot; );
        }
        // Pass in an audioContext
        BaseSound.call( this, context );

        if ( typeof context !== &quot;undefined&quot; ) {
            this.audioContext = context;
        }

        this.numberOfInputs = 1;
        this.numberOfOutputs = 1;
        /**
         * The input node that the output node will be connected to.
         *
         * @property inputNode
         * @type Object
         * @default Internal Release-GainNode
         */
        this.inputNode = this.releaseGainNode;

        // Set gain to 0
        this.releaseGainNode.gain.value = 0;

        // Envelope Characteristics
        var attackDur;
        var decayDur;
        var sustainDur;
        var releaseDur;
        var sustainVal;
        var useSustain;

        // Constants
        var attackVal = 1;
        var releaseVal = 0;

        /**
         * Start the Envelope.
         *
         * @method start
         * @param {Number} [when] Time (in seconds) at which the Envelope will start.
         */
        this.start = function start( when ) {
            BaseSound.prototype.start.call( this, when );
            if ( typeof when === &quot;undefined&quot; || when &lt; this.audioContext.currentTime ) {
                when = this.audioContext.currentTime;
            }

            // Set the ADSR using Web Audio default audio param
            // Clamp the current gain value at this time
            // If this is not done, the attack linearRampToValueAtTime does not ramp up to 1 smoothly, rather it jumps to 1.
            this.releaseGainNode.gain.setValueAtTime( this.releaseGainNode.gain.value, when );

            // Attack - now this ramp up nicely
            this.releaseGainNode.gain.linearRampToValueAtTime( attackVal, when + attackDur );

            // Decay
            this.releaseGainNode.gain.linearRampToValueAtTime( sustainVal, when + attackDur + decayDur );

            // Sustain
            this.releaseGainNode.gain.linearRampToValueAtTime( sustainVal, when + attackDur + decayDur + sustainDur );

            if ( !useSustain ) {
                // Release
                this.releaseGainNode.gain.linearRampToValueAtTime( releaseVal, when + attackDur + decayDur + sustainDur + releaseDur );
            }
        };

        /**
         * Stop the Envelope.
         *
         * @method stop
         * @param {Number} [when] Time (in seconds) at which the Envelope will stop.
         */
        this.stop = function stop( when ) {
            BaseSound.prototype.stop.call( this, when );
            if ( typeof when === &quot;undefined&quot; ) {
                when = this.audioContext.currentTime;
            }
            // cancel all scheduled ramps on this releaseGainNode
            this.releaseGainNode.gain.cancelScheduledValues( when );
        };

        /**
         * Connect to release Gain Node.
         *
         * @method connect
         * @param {AudioNode} destination AudioNode to connect to.
         * @param {Number} [output] Index describing which output of the AudioNode from which to connect.
         * @param {Number} [input] Index describing which input of the destination AudioNode to connect to.
         */
        this.connect = function connect( destination, output, input ) {
            BaseSound.prototype.connect.call( this, destination, output, input );
        };

        /**
         * Disconnect from release Gain Node.
         *
         * @method disconnect
         * @param {Number} [outputIndex]  Index describing which output of the AudioNode to disconnect.
         */
        this.disconnect = function disconnect( outputIndex ) {
            BaseSound.prototype.disconnect.call( this, outputIndex );
        };

        /**
         * Linearly ramps down the gain of releaseGainNode from current value to 0 in fadeTime (s). It is better to call this method on a user initiated event or after some time (in seconds) has passed.
         *
         * @method release
         * @param {Number} [fadeTime] Amount of time (seconds) taken to release or fade out the sound.
         * @param {Number} [when] Time (in seconds) at which the Envelope will release.
         */
        this.release = function release( fadeTime, when ) {
            if ( typeof when === &quot;undefined&quot; ) {
                when = this.audioContext.currentTime;
            }

            if ( typeof fadeTime === &quot;undefined&quot; ) {
                fadeTime = releaseDur;
            }

            BaseSound.prototype.release.call( this, fadeTime, when );
        };

        /**
         * Initialize as a classic four-segment ADSR (Attack, Decay, Sustain, Release) envelope.
         *
         * @method initADSR
         * @param {Object} [options] Values that can be passed in to change the shape of the ADSR Envelope.
         *  @param {Boolean} [options.useSustain=false]   If true, hold the sustain end val indefinitely until stop() is called.
         * @param {Number} [options.attackDur=0.01]     Attack Duration (s)
         * @param {Number} [options.decayDur=0.01]      Decay Duration (s)
         * @param {Number} [options.releaseDur=0.01]    Release Duration (s)
         * @param {Number} [options.sustainVal=0.5]    Sustain Level (s)
         */
        this.initADSR = function ( options ) {
            if ( options ) {
                useSustain = options.useSustain || false;
                attackDur = options.attackDur || 0.01;
                decayDur = options.decayDur || 0.01;
                sustainDur = options.sustainDur || 0.01;
                releaseDur = options.releaseDur || 0.01;
                sustainVal = options.sustainVal || 0.5;
            } else {
                useSustain = false;
                attackDur = 0.01;
                decayDur = 0.01;
                sustainDur = 0.01;
                releaseDur = 0.01;
                sustainVal = 0.5;
            }

            this.releaseGainNode.gain.value = 0;
        };

        /**
         * Resets all flags and counters to begin a new envelope traversal.
         *
         * @method reinit
         * @param {Boolean} [hard]  If true, do &#x27;hard&#x27; reinit, otherwise attempt to smoothly continue current envelope value.
         * @param {Number} [when] Time (in seconds) at which the Envelope will reinit.
         */
        this.reinit = function ( hard, when ) {
            hard = hard || false;
            if ( typeof when === &quot;undefined&quot; ) {
                when = this.audioContext.currentTime;
            }
            if ( hard ) {
                // cancel all scheduled ramps on this releaseGainNode
                this.releaseGainNode.gain.cancelScheduledValues( when );
                // Set gain to 0
                this.releaseGainNode.gain.value = 0;
            } else {
                // Clamp the current gain value at this time
                // If this is not done, the attack linearRampToValueAtTime does not ramp up to 1 smoothly, rather it jumps to 1.
                this.releaseGainNode.gain.setValueAtTime( this.releaseGainNode.gain.value, when );
            }
        };

        this.initADSR();
    }

    Envelope.prototype = Object.create( Envelope.prototype );
    // Return constructor function
    return Envelope;
} );

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
